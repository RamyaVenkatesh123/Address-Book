import pymysql
from tabulate import tabulate


try:
    con=pymysql.connect(host='localhost',user='root',passwd='Ramya',db='addressbook')
    cursor=con.cursor()

    headers=['Name','Phone','City']

    def search():
        info=input("Search name/phone number/city")
        cmd="select * from contactlist where namelist like '%"+info+"%' or phone like '%"+info+"%'or city like '%"+info+"%'"
        cursor.execute(cmd)
        data=cursor.fetchall()
        if len(data)>0:
            print(tabulate(data,headers,tablefmt="fancy-grid",numalign='center',stralign='center'))
        else:
            print("Given data not found")
        print("------------------------------------------------------------------")

    def viewall():
        cmd="select * from contactlist"
        cursor.execute(cmd)
        data=cursor.fetchall()
        print(tabulate(data,headers,tablefmt="fancy-grid",numalign='center',stralign='center'))
        print("------------------------------------------------------------------")
        
    def add():
        name=input("Enter your Name")
        phone=int(input("Enter your phone number"))
        city=input("Enter your city")
        column=(name,phone,city)
        cmd="insert into contactlist values(%s,%s,%s)"
        cursor.execute(cmd,column)
        print("------------------------------------------------------------------")

    def edit():
        editname=input("Enter the name you want to edit")
        cmd="select * from contactlist where namelist '%s'" %(editname)
        cursor.execute(cmd)
        if cursor.fetchone():
            print("What do you want to edit")
            print("1.Name\n2.Phone number\n3.City")
            Ch=int(input("Enter your Choice"))
            if Ch==1:
                name=input("Enter the Name:")
                cmd="update contactlist set namelist='%s' where namelist='%s'"%(name,editname)
                cursor.execute(cmd)
                print("Name updated Successfully")
            elif Ch==2:
                phone=input("Enter the Phone Number:")
                cmd="update contactlist set phone='%d' where namelist='%s'"%(phone,editname)
                cursor.execute(cmd)
                print("Phone number updated Successfully")
            elif Ch==3:
                city=input("Enter the City:")
                cmd="update contactlist set city='%s' where namelist='%s'"%(city,editname)
                cursor.execute(cmd)
                print("Name updated Successfully")
            else:
                print("Choice number is incorrect")
        else:
            print("Name not found")
        print("------------------------------------------------------------------")

    def delete():
        name=input("Enter the name you want to delete")
        cmd="select * from contactlist where namelist'%s'"%(name)
        cursor.execute(cmd)
        if cursor.fetchone():
            print("Are you sure do you want to delete")
            print("1.Yes\n 2.No")
            confirm=int(input("Enter the Choice numer:"))
            if confirm==1:
                cmd="delete from contactlist where namelist='%s'"%(name)
                cursor.execute(cmd)
                print("Deleted this contact successfully")
        else:
            print("Name not found")
        print("-----------------------------------------------------------------------------")

    def delall():
        print("Do you want to delete all contacts")
        print("1.Yes\n2.No")
        confirm=int(input("Enter you Choice:"))
        if (confirm==1):
            cmd="truncate table contactlist"
            cursor.execute(cmd)
            print("Deleted all contacts successfully")
        print("----------------------------------------------------------------------------")








    while True:
        print("What do you want to do?")
        print("1.Search Contact\n2.View all Contacts\n3.Add Contact\n4.Edit Contact \n5.Delete Contact\n 6.Delete all Contacts\n 7.close")
        choice=int(input("Enter your Choice"))
                
        if choice==1:
            search()

        elif choice==2:
            viewall()

        elif choice==3:
            add()

        elif choice==4:
            edit()
        
        elif choice==5:
            delete()

        elif choice==6:
            delall()

        else:
            print("Address Book Closed")
            con.close()

except(Exception) as ex:
    print(ex.__class__,ex.args)
    print("Something went wrong")